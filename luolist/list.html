<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>数据列表</title>
    <link rel="stylesheet" href="css/bootstrap.css" type="text/css"/>
    <link rel="stylesheet" href="css/DatetimePicker/bootstrap.css" type="text/css"/>
    <link rel="stylesheet" href="css/DatetimePicker/bootstrap-datetimepicker.min.css" type="text/css"/>
    <style>
        body {
            width: 90%;
            margin: 0 auto;
        }

        .search {
            display: flex;
            justify-content: center;
            margin: 10px;
        }

        .search > .time {
            margin: 0 10px;
        }

        .search > .time > div > input {
            width: 150px;
            height: 30px;
            line-height: 30px;
            padding-left: 5px;
        }

        .search > span {
            line-height: 30px;
        }

    </style>
</head>
<body>
<div class="search">
    <div class="time">
        <div data-date="" data-link-field="StartTime" class="input-group date form_datetime_tostarttime">
            <input id="StartTime" readonly="readonly" class="hex-datetimepicker">
            <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
        </div>
    </div>
    <span>至</span>
    <div class="time">
        <div data-date="" data-link-field="EndTime" class="input-group date form_datetime_toendtime">
            <input id="EndTime" readonly="readonly" class="hex-datetimepicker">
            <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
        </div>
    </div>
    <button type="button" class="btn btn-success btn-sm" id="todoTime">搜索</button>
</div>
<table class="table table-striped">
    <thead>
    <tr>
        <th>#</th>
        <th>姓名</th>
        <th>所用模块</th>
        <th>时间</th>
    </tr>
    </thead>
    <tbody id="listDate">
    <tr v-for="(el,index) in list">
        <th scope="row" v-text="(index+1)"></th>
        <td v-text="el.UserId"></td>
        <td v-text="el.OperationModuleName"></td>
        <td v-text="el.Time"></td>
    </tr>
    </tbody>
</table>
<div class="pull-right">
    <nav aria-label="Page navigation">
        <ul class="pagination" id="datePage">
            <li><a href="#" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>
            <li v-for="el in list" v-bind:class="{'active':el==activePage}"><a href="#" v-text="el"></a></li>
            <li><a href="#" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>
        </ul>
    </nav>
</div>
</body>
<script src="jquery-1.10.2.js"></script>
<script src="vue.min.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/DatetimePicker/bootstrap-datetimepicker.js"></script>
<script src="js/DatetimePicker/locales/bootstrap-datetimepicker.zh-CN.js"></script>
<script src="base.js"></script>
<script>
    var vm_listdate = new Vue({
        el: "#listDate",
        data: {
            list: []
        }
    });
    var vm_datePage = new Vue({
        el: "#datePage",
        data: {
            activePage: 1,
            list: [1, 2, 3, 4, 5] //页码
        }
    });

    (function () {
        var token = Config.getToken();

        (function () {
            initSetTime();
            changeTime();
            changePage();
        })()

        function initSetTime() {
            var startTime = new Date();
            var endTime = new Date();
            startTime.setDate(endTime.getDate() - 7);

            $('.form_datetime_tostarttime').datetimepicker({
                language: 'zh-CN',
                weekStart: 1,
                todayBtn: true,
                autoclose: true,
                todayHighlight: 1,
                startView: 2,
                forceParse: 0,
                showMeridian: 1,
                minuteStep: 10,
                maxView: 3,
                minView: 2,
                format: 'yyyy/mm/dd',
                linkFormat: "yyyy/mm/dd",
                initialDate: startTime
            });
            $("#StartTime").val(Config.Datetimeformat2(startTime));

            $('.form_datetime_toendtime').datetimepicker({
                language: 'zh-CN',
                weekStart: 1,
                todayBtn: true,
                autoclose: true,
                todayHighlight: 1,
                startView: 2,
                forceParse: 0,
                showMeridian: 1,
                minuteStep: 10,
                maxView: 3,
                minView: 2,
                format: 'yyyy/mm/dd',
                linkFormat: "yyyy/mm/dd",
                initialDate: endTime
            });
            $("#EndTime").val(Config.Datetimeformat2(endTime));

//            GetDate(Config.Datetimeformat2(startTime), Config.Datetimeformat2(endTime));
            GetDate("2019/04/01", "2019/05/01");
        }

        function GetDate(StartTime, EndTime) {
            $.ajax({
                url: Config._webApi + "/UserTrajectory/SearchByTimeRange?ssotoken=" + token,
                method: "POST",
                data: {"StartTime": StartTime, "EndTime": EndTime, "LastNum": 1000},
                success: function (data) {
                    data.forEach(function (item) {
                        item.Time = Config.Datetimeformat(new Date(item.Time));
                    })
                    vm_listdate.list = data;
                }
            });
        }

        function changeTime() {
            $("#todoTime").click(function () {
                var starttime = $("#StartTime").val();
                var endTime = $("#EndTime").val();
                console.log(starttime + "-- " + endTime);
            })
        }

        function changePage() {
            $("#datePage [aria-label='Previous']").click(function () {
                if (vm_datePage.activePage > 1) {
                    vm_datePage.activePage--;
                }
            })
            $("#datePage [aria-label='Next']").click(function () {
                if (vm_datePage.activePage < vm_datePage.list[vm_datePage.list.length - 1]) {
                    vm_datePage.activePage++;
                }
            })
            $("#datePage a:not([aria-label])").click(function () {
                vm_datePage.activePage = parseInt($(this).text());
            })
        }
    })()
</script>
</html>