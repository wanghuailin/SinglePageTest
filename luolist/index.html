<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>功能列表页</title>
    <link rel="stylesheet" href="css/bootstrap.css" type="text/css"/>
</head>
<body>
<div class="center-block" style="width: 80%;margin-top: 20px">
    <div class="clearfix">
        <a href="weights.html" type="button" class="pull-right btn btn-link" role="button">权重管理</a>
    </div>
    <div class="panel panel-default">
        <div class="panel-heading">功能列表</div>
        <div class="list-group-item clearfix" style="display: flex">
            <span>添加一个新功能</span>
            <select id="dataSourceType">
                <option v-for="(el,index) in list" v-if="el" v-text="el" v-bind:value="(index+1)">

                </option>
            </select>
            <input type="text" class="form-control" style="width: auto;flex: 1" id="createcontent">
            <button type="button" class="btn btn-primary pull-right" id="create">
                <span class="glyphicon glyphicon glyphicon-plus" aria-hidden="true"></span>
            </button>
        </div>
        <ul class="list-group" id="scoreList">
            <li class="list-group-item clearfix" v-for="el in list">
                <a v-bind:href="'content.html?id='+el.ActivityModuleId" v-text="el.Name"></a>
                <span class="label label-info">{{el.DataSourceType|DataSourceType}}</span>
                <div class="pull-right">
                    <button type="button" class="btn btn-success" v-bind:ModuleId="el.ActivityModuleId"
                            v-bind:name="el.Name" hex-edit="">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                    </button>
                    <button type="button" class="btn btn-danger" v-bind:ModuleId="el.ActivityModuleId"
                            hex-remove="">
                        <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                    </button>
                </div>
            </li>
        </ul>
    </div>
</div>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">修改名称</h4>
            </div>
            <div class="modal-body" style="display: flex">
                <select id="dataSourceType2" class="form-control" style="width: 150px">
                    <option v-for="(el,index) in list" v-if="el" v-text="el" v-bind:value="(index+1)">

                    </option>
                </select>
                <input type="text" class="form-control" id="editcontent">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="edittextbtn">确定</button>
            </div>
        </div>
    </div>
</div>
</body>
<script src="jquery-1.10.2.js"></script>
<script src="vue.min.js"></script>
<script src="js/bootstrap.js"></script>
<script src="base.js"></script>
<script>
    var dataSourceType = ["行为", "业务"];

    var scoreListData = new Vue({
        el: '#scoreList',
        data: {
            list: []
        },
        filters: {
            DataSourceType: function (value) {
                return dataSourceType[parseInt(value - 1)] == undefined ? "未知" : dataSourceType[parseInt(value - 1)];
            }
        }
    })

    //平台类型
    new Vue({
        el: "#dataSourceType",
        data: {
            list: dataSourceType
        }
    })
    new Vue({
        el: "#dataSourceType2",
        data: {
            list: dataSourceType
        }
    })

    var token = Config.getToken();
    var xx = function () {
        (function () {
            GetInit();
            $(document.body).on("click", "#create", function () {
                Create($("#createcontent").val(), $("#dataSourceType").val());
            })
            $(document.body).on("click", "[hex-edit]", function () {
                $('#myModal').modal('show');
                $("#editcontent").val($(this).attr("name")).attr("mid", $(this).attr("ModuleId"));
            })
            $(document.body).on("click", "#edittextbtn", function () {
                Modify($("#editcontent").attr("mid"), $("#editcontent").val(), $("#dataSourceType2").val());
                $('#myModal').modal('hide');
            })
            $(document.body).on("click", "[hex-remove]", function () {
                Remove($(this).attr("ModuleId"));
            })
        })()

        function GetInit() {
            $.ajax({
                url: Config._webApi + "/ActivityModule/FindAll?ssotoken=" + token,
                method: "GET",
                data: "",
                success: function (data) {
                    scoreListData.list = data;
                }
            });
        }

        function Create(name, dst) {
            $.ajax({
                url: Config._webApi + "/ActivityModule/Create?name=" + name + "&dataSourceType=" + dst + "&ssotoken=" + token,
                method: "POST",
                data: {"name": name, "dataSourceType": dst},
                success: function (data) {
                    GetInit();
                }
            });
        }

        function Modify(mid, name, dst) {
            $.ajax({
                url: Config._webApi + "/ActivityModule/Modify?activityModuleId=" + mid + "&name=" + name + "&dataSourceType=" + dst + "&ssotoken=" + token,
                method: "POST",
                data: {"activityModuleId": mid, "name": name, "dataSourceType": dst},
                success: function (data) {
                    GetInit();
                }
            });
        }

        function Remove(mid) {
            $.ajax({
                url: Config._webApi + "/ActivityModule/Remove?activityModuleId=" + mid + "&ssotoken=" + token,
                method: "POST",
                data: {"activityModuleId": mid},
                success: function (data) {
                    GetInit();
                }
            });
        }
    }()
</script>
</html>